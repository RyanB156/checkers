

<p id="gameCode"></p>
<button id="getGameCodeButton" onclick="getGameCode()">Get Join Code</button>

<button onclick="start()">Start</button>

<style>
  .white {
    background-color: white;
  }

  .red {
    background-color: red;
  }

  .piece {
    width: 36px;
    height: 36px;
    border-radius: 18px;
  }

  .kingMark {
    position: relative;
    font-size: 1.1em;
    width: 18px;
    top: 6px;
    left: 12px;
  }

  .red .kingMark {
    color: white;
  }

  .white .kingMark {
    color: black;
  }

  .piece:hover {
    cursor: grab;
  }

  .gridSquare {
    width: 40px;
    height: 40px;
    border: 1px black solid;
  }

  .blackSquare {
    background-color: black;
  }

  .whiteSquare {
    background-color: rgb(200, 200, 200);
  }
</style>

<table id="board" class="mt-5"></table>

<script>
  async function getGameCode() {
    
    fetch('/action/getGameCode', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
      })
    .then(response => response.text())
    .then(data => {
      console.log(data);
      let gameCodeMessage = `You are hosting game <b>${data}</b><br> Share this with your friend so they can join!`
      document.getElementById('gameCode').innerHTML = gameCodeMessage;
      Cookies.set('gameCode', data);
      document.getElementById('getGameCodeButton').style = "display:none;";
    });
  }

  async function start() {
    fetch('/action/startGame', {
      method: 'POST',
        headers: {'Content-Type': 'application/json'},
    })
    .then(response => response.text())
    .then(data => {
      let board = JSON.parse(data);
      draw(board);
    })
  }


  // Board is a 2D array of Pieces
  function draw(board) {
    console.log('board: ', board);
    let inner = '';
    let table = document.getElementById('board');
    for (let row = 0; row < 8; row++) {
      let tr = document.createElement('tr');
      for (let col = 0; col < 8; col++) {
        let piece = board[row][col];

        let dataClass;
        if (piece === undefined || piece === null) {
          dataClass = '';
        } else {
          dataClass = piece['team'] === 'W' ? 'white' : 'red';
        }
        let squareClass = (row + col) % 2 === 0 ? 'blackSquare' : 'whiteSquare';
        // TODO: Draw kings differently.
        // rowData += `<td class="${squareClass} gridSquare">${dataClass !== '' ? `<div class="${dataClass} piece"></div>` : '<div class="piece"></div>'}</td>`;
        let td = document.createElement('td');
        td.className += ' ' + squareClass + ' gridSquare';

        let tdPiece = document.createElement('div');
        if (dataClass !== '') {
          tdPiece.className += ' ' + dataClass + ' piece';
          if (piece['isKing']) {
            let kingMark = document.createElement('div');
            kingMark.className += ' ' + 'kingMark';
            kingMark.innerHTML = 'K';
            tdPiece.appendChild(kingMark);
          }
        }
        td.appendChild(tdPiece);
        tr.appendChild(td);
      }
      table.appendChild(tr);
    }

    console.log(table.innerHTML);
  }

</script>